<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bin Collections - Royston</title>
  <style>
    @font-face{
      font-family:'LeagueSpartan';
      src:url('LeagueSpartan-Bold.woff2') format('woff2'),
          url('LeagueSpartan-Bold.woff') format('woff');
      font-weight:700;
    }
    body{
      margin:0;
      background:#000;
      color:#17D860;
      font-family:'LeagueSpartan', Arial, Helvetica, sans-serif;
      padding:20px;
    }
    .logo{
      width:120px;
      margin-bottom:20px;
    }
    .box{
      background:#0a0a0a;
      padding:20px;
      border-radius:10px;
      border:1px solid #17D86033;
      margin-bottom:20px;
    }
    h1{color:#17D860;margin-top:0;font-family:'LeagueSpartan';}
    .day-title{font-size:22px;margin-bottom:10px;color:#17D860;font-family:'LeagueSpartan'}
    .bin-item{padding:10px 0;border-bottom:1px solid #17D86022;font-size:18px}
    .bin-item:last-child{border-bottom:none}
  </style>
</head>
<body>
<img src="logo2.png" alt="Logo" class="logo">

<h1>Bin Collections - Royston</h1>

<div class="box">
  <div class="day-title">Today</div>
  <div id="todayList">Loading...</div>
</div>

<div class="box">
  <div class="day-title">Tomorrow</div>
  <div id="tomorrowList">Loading...</div>
</div>

<script>
const MS_DAY = 86400000;
function toUTCDate(y,m,d){return new Date(Date.UTC(y,m-1,d,12));}

const bins = [
  {name:'Non-Recyclable Waste', start:toUTCDate(2025,11,17), interval:3},
  {name:'Food Waste', start:toUTCDate(2025,11,17), interval:1},
  {name:'Mixed Recycling', start:toUTCDate(2025,11,24), interval:3},
  {name:'Garden Waste', start:toUTCDate(2025,11,24), interval:2},
  {name:'Cardboard & Paper', start:toUTCDate(2025,12,1), interval:3}
];

function nextMonday(d){
  const day = d.getUTCDay();
  if(day === 1) return new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate(), 12));
  const diff = (1 - day + 7) % 7;
  return new Date(d.getTime() + diff*MS_DAY);
}

function isCollection(bin, date){
  if(date < bin.start) return false;
  const weeks = Math.round((date - bin.start)/ (MS_DAY*7));
  return weeks % bin.interval === 0;
}

function listFor(date){
  return bins.filter(b=>isCollection(b,date)).map(b=>`<div class='bin-item'>${b.name}</div>`).join('') || '<div class="bin-item">No bins</div>';
}

function run(){
  const now = new Date();
  now.setUTCHours(12,0,0,0);

  const tomorrowDate = new Date(now.getTime() + MS_DAY);
  tomorrowDate.setUTCHours(12,0,0,0);

  const todayIsMonday = now.getUTCDay() === 1;
  const tomorrowIsMonday = tomorrowDate.getUTCDay() === 1;

  document.getElementById('todayList').innerHTML = todayIsMonday ? listFor(now) : '<div class="bin-item">No bins</div>';
  document.getElementById('tomorrowList').innerHTML = tomorrowIsMonday ? listFor(tomorrowDate) : '<div class="bin-item">No bins</div>';
}

run();
</script>

<div class="box">
  <div class="day-title">All Bins & Next Collection</div>
  <div id="allBinsList">Loading...</div>
</div>

<script>
// extend run() to fill all bins list
function nextDateFor(bin){
  const now = new Date();
  let d = nextMonday(now);
  for(let i=0;i<20;i++){
    if(isCollection(bin, d)) return d;
    d = new Date(d.getTime() + 7*MS_DAY);
  }
  return null;
}

function loadAllBins(){
  const html = bins.map(b=>{
    const nd = nextDateFor(b);
    const fd = nd ? nd.toLocaleDateString('en-GB',{weekday:'short',day:'2-digit',month:'short'}) : 'N/A';
    return `<div class='bin-item'><strong>${b.name}</strong><br>Cycle: ${b.interval===1? 'Every Monday' : b.interval===2? 'Every Monday fortnightly' : 'Every 3rd Monday'}<br>Next: $ ${fd}</div>`;
  }).join('');
  document.getElementById('allBinsList').innerHTML = html;
}

loadAllBins();
</script>

</body>
</html>
